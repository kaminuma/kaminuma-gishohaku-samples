<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini AI æŒ¯ã‚Šè¿”ã‚Šåˆ†æã‚µãƒ³ãƒ—ãƒ«</title>
    <style>
        /* åŸºæœ¬çš„ãªã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        main {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }
        
        @media (max-width: 768px) {
            main {
                grid-template-columns: 1fr;
            }
        }
        
        /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
        }
        
        h2 {
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        /* åˆ†æãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š */
        .parameter-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #555;
        }
        
        select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 16px;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        /* ãƒœã‚¿ãƒ³ */
        .button-container {
            margin-top: 30px;
            text-align: center;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* æ´»å‹•ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ« */
        .activities-container {
            max-height: 500px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background: #667eea;
            color: white;
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background: #f5f5f5;
        }
        
        /* ãƒ ãƒ¼ãƒ‰è¡¨ç¤º */
        .mood {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: bold;
            color: white;
        }
        
        .mood-1 { background: #e74c3c; }
        .mood-2 { background: #e67e22; }
        .mood-3 { background: #f39c12; }
        .mood-4 { background: #27ae60; }
        .mood-5 { background: #2ecc71; }
        
        /* åˆ†æçµæœ */
        .analysis-result {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-top: 20px;
            min-height: 200px;
            white-space: normal;
            line-height: 1.9;
            border: 1px solid #e8e9ea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .analysis-result h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        .analysis-result strong {
            color: #444;
            font-weight: 600;
        }
        
        .analysis-content {
            margin-bottom: 25px;
            font-size: 15px;
            line-height: 1.9;
        }
        
        .analysis-content div {
            margin: 18px 0;
            line-height: 1.9;
        }
        
        .analysis-content strong {
            color: #333;
            font-weight: 600;
        }
        
        .analysis-meta {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
            font-size: 0.9em;
            color: #666;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        
        .loading {
            text-align: center;
            color: #999;
            padding: 40px;
        }
        
        .error {
            color: #e74c3c;
            padding: 20px;
            background: #ffe6e6;
            border-radius: 5px;
            margin-top: 20px;
        }
        
        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼ */
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* èª¬æ˜æ–‡ */
        .help-text {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        
        /* æ—¥æ¬¡ãƒ ãƒ¼ãƒ‰ã‚«ãƒ¼ãƒ‰ */
        .mood-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px 8px;
            text-align: center;
            min-width: 100px;
            flex: 1;
            max-width: 120px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .mood-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .mood-date {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .mood-value {
            font-size: 2em;
            margin: 10px 0;
        }
        
        .mood-description {
            font-size: 0.85em;
            color: #555;
        }
        
        .mood-note {
            font-size: 0.8em;
            color: #888;
            margin-top: 5px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header>
            <h1>ğŸ¤– Gemini AI æŒ¯ã‚Šè¿”ã‚Šåˆ†æ</h1>
            <p class="subtitle">1é€±é–“ã®æ´»å‹•ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã¦ã€ã‚¤ãƒ³ã‚µã‚¤ãƒˆã‚’æä¾›ã—ã¾ã™</p>
        </header>
        
        <main>
            <!-- å·¦å´ï¼šåˆ†æè¨­å®šã¨å®Ÿè¡Œ -->
            <section>
                <h2>ğŸ“Š åˆ†æè¨­å®š</h2>
                
                <!-- åˆ†æãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®é¸æŠ -->
                <div class="parameter-group">
                    <label for="focus">åˆ†æã®ç„¦ç‚¹ï¼ˆFocusï¼‰</label>
                    <select id="focus">
                        <option value="mood">æ°—åˆ† - ãƒ ãƒ¼ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã®åˆ†æ</option>
                        <option value="activities">æ´»å‹• - æ´»å‹•ã®å¤šæ§˜æ€§ã¨é…åˆ†</option>
                        <option value="balance" selected>ãƒãƒ©ãƒ³ã‚¹ - ç”Ÿæ´»ãƒãƒ©ãƒ³ã‚¹ã®è©•ä¾¡</option>
                        <option value="wellness">ã‚¦ã‚§ãƒ«ãƒã‚¹ - ç·åˆçš„ãªå¥åº·è©•ä¾¡</option>
                    </select>
                    <p class="help-text">ã©ã®è¦³ç‚¹ã‹ã‚‰åˆ†æã™ã‚‹ã‹ã‚’é¸æŠã—ã¾ã™</p>
                </div>
                
                <div class="parameter-group">
                    <label for="detail_level">è©³ç´°ãƒ¬ãƒ™ãƒ«ï¼ˆDetail Levelï¼‰</label>
                    <select id="detail_level">
                        <option value="brief">ç°¡æ½” - è¦ç‚¹ã®ã¿ï¼ˆ3-5é …ç›®ï¼‰</option>
                        <option value="standard" selected>æ¨™æº– - é©åº¦ãªè©³ç´°ï¼ˆæ´å¯Ÿã¨ææ¡ˆï¼‰</option>
                        <option value="detailed">è©³ç´° - å¾¹åº•çš„ãªåˆ†æï¼ˆ5é …ç›®ä»¥ä¸Šï¼‰</option>
                    </select>
                    <p class="help-text">åˆ†æçµæœã®è©³ç´°åº¦ã‚’é¸æŠã—ã¾ã™</p>
                </div>
                
                <div class="parameter-group">
                    <label for="response_style">å¿œç­”ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆResponse Styleï¼‰</label>
                    <select id="response_style">
                        <option value="friendly" selected>è¦ªã—ã¿ã‚„ã™ã„ - å‹äººã®ã‚ˆã†ãªèªã‚Šå£</option>
                        <option value="professional">å°‚é–€çš„ - ãƒ‡ãƒ¼ã‚¿é‡è¦–ã®å®¢è¦³çš„åˆ†æ</option>
                        <option value="encouraging">åŠ±ã¾ã— - ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³å‘ä¸Šé‡è¦–</option>
                        <option value="casual">ã‚«ã‚¸ãƒ¥ã‚¢ãƒ« - æ°—è»½ã§ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ãŸé›°å›²æ°—</option>
                    </select>
                    <p class="help-text">åˆ†æçµæœã®æ–‡ä½“ã‚’é¸æŠã—ã¾ã™</p>
                </div>
                
                <!-- åˆ†æå®Ÿè¡Œãƒœã‚¿ãƒ³ -->
                <div class="button-container">
                    <button id="analyzeBtn" onclick="runAnalysis()">
                        ğŸš€ åˆ†æã‚’å®Ÿè¡Œ
                    </button>
                </div>
                
                <!-- åˆ†æçµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                <div id="analysisResult" class="analysis-result" style="display: none;">
                    <!-- ã“ã“ã«åˆ†æçµæœãŒè¡¨ç¤ºã•ã‚Œã‚‹ -->
                </div>
            </section>
            
            <!-- å³å´ï¼šæ´»å‹•ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º -->
            <section>
                <h2>ğŸ“… ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆéå»1é€±é–“ï¼‰</h2>
                
                <!-- æ—¥æ¬¡ãƒ ãƒ¼ãƒ‰è¡¨ç¤º -->
                <div style="margin-bottom: 15px;">
                    <h3 style="color: #667eea; font-size: 1.1em; margin-bottom: 10px;">ğŸ“Š æ—¥æ¬¡ãƒ ãƒ¼ãƒ‰</h3>
                    <div id="moodContainer" style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 15px;">
                        <!-- ã“ã“ã«æ—¥æ¬¡ãƒ ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹ -->
                    </div>
                </div>
                
                <!-- æ´»å‹•ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º -->
                <h3 style="color: #667eea; font-size: 1.1em; margin-bottom: 10px;">ğŸ“ æ´»å‹•è¨˜éŒ²</h3>
                <div class="activities-container">
                    <table id="activitiesTable">
                        <thead>
                            <tr>
                                <th>æ—¥ä»˜</th>
                                <th>æ™‚é–“ç¯„å›²</th>
                                <th>æ´»å‹•</th>
                                <th>ã‚«ãƒ†ã‚´ãƒª</th>
                            </tr>
                        </thead>
                        <tbody id="activitiesBody">
                            <!-- ã“ã“ã«æ´»å‹•ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹ -->
                        </tbody>
                    </table>
                </div>
                <p class="help-text" style="margin-top: 10px;">
                    â€» ã“ã®ãƒ‡ãƒ¼ã‚¿ã¯ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚µãƒ³ãƒ—ãƒ«ã§ã™
                </p>
            </section>
        </main>
    </div>
    
    <script>
        /**
         * ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–å‡¦ç†
         */
        document.addEventListener('DOMContentLoaded', function() {
            // æ´»å‹•ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
            loadActivities();
            // æ—¥æ¬¡ãƒ ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
            loadDailyMoods();
        });
        
        /**
         * æ´»å‹•ãƒ‡ãƒ¼ã‚¿ã‚’ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å–å¾—ã—ã¦è¡¨ç¤º
         */
        async function loadActivities() {
            try {
                // APIã‹ã‚‰æ´»å‹•ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                const response = await fetch('/api/activities');
                const result = await response.json();
                
                if (result.status === 'success') {
                    // ãƒ†ãƒ¼ãƒ–ãƒ«ã«æ´»å‹•ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
                    displayActivities(result.data);
                } else {
                    console.error('æ´»å‹•ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('activitiesBody').innerHTML = 
                    '<tr><td colspan="4" style="text-align: center; color: red;">ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</td></tr>';
            }
        }
        
        /**
         * æ´»å‹•ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¡¨ç¤º
         * @param {Array} activities - æ´»å‹•ãƒ‡ãƒ¼ã‚¿ã®é…åˆ—
         */
        function displayActivities(activities) {
            const tbody = document.getElementById('activitiesBody');
            tbody.innerHTML = ''; // ãƒ†ãƒ¼ãƒ–ãƒ«å†…å®¹ã‚’ã‚¯ãƒªã‚¢
            
            // å„æ´»å‹•ã‚’ãƒ†ãƒ¼ãƒ–ãƒ«è¡Œã¨ã—ã¦è¿½åŠ 
            activities.forEach(activity => {
                const row = document.createElement('tr');
                
                // æ™‚é–“ç¯„å›²ã‚’ä½œæˆ
                const timeRange = `${activity.start_time || '??:??'} - ${activity.end_time || '??:??'}`;
                
                // ã‚«ãƒ†ã‚´ãƒªè¡¨ç¤º
                let categoryDisplay = activity.category || '';
                if (activity.category_sub) {
                    categoryDisplay += `/${activity.category_sub}`;
                }
                
                row.innerHTML = `
                    <td>${activity.date}</td>
                    <td>${timeRange}</td>
                    <td>${activity.title || ''}<br><small style="color: #666;">${activity.contents || ''}</small></td>
                    <td>${categoryDisplay}</td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        /**
         * æ—¥æ¬¡ãƒ ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å–å¾—ã—ã¦è¡¨ç¤º
         */
        async function loadDailyMoods() {
            try {
                // APIã‹ã‚‰æ—¥æ¬¡ãƒ ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                const response = await fetch('/api/daily-moods');
                const result = await response.json();
                
                if (result.status === 'success') {
                    // ãƒ ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
                    displayDailyMoods(result.data);
                } else {
                    console.error('æ—¥æ¬¡ãƒ ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('moodContainer').innerHTML = 
                    '<p style="color: red;">ãƒ ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
            }
        }
        
        /**
         * æ—¥æ¬¡ãƒ ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
         * @param {Array} moods - æ—¥æ¬¡ãƒ ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®é…åˆ—
         */
        function displayDailyMoods(moods) {
            const container = document.getElementById('moodContainer');
            container.innerHTML = ''; // ã‚³ãƒ³ãƒ†ãƒŠå†…å®¹ã‚’ã‚¯ãƒªã‚¢
            
            // ãƒ ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’æ—¥ä»˜é †ã«ã‚½ãƒ¼ãƒˆ
            moods.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // å„æ—¥ã®ãƒ ãƒ¼ãƒ‰ã‚’ã‚«ãƒ¼ãƒ‰ã¨ã—ã¦è¡¨ç¤º
            moods.forEach(mood => {
                const card = document.createElement('div');
                card.className = 'mood-card';
                
                // æ—¥ä»˜ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
                const date = new Date(mood.date);
                const month = date.getMonth() + 1;
                const day = date.getDate();
                const dateStr = `${month}/${day}`;
                const dayOfWeek = date.toLocaleDateString('ja-JP', { weekday: 'short' });
                
                // ãƒ ãƒ¼ãƒ‰ã«å¿œã˜ãŸçµµæ–‡å­—ã‚’å–å¾—
                const moodEmojis = {
                    1: 'ğŸ˜«',
                    2: 'ğŸ˜',
                    3: 'ğŸ˜',
                    4: 'ğŸ˜Š',
                    5: 'ğŸ˜„'
                };
                
                const moodDescriptions = {
                    1: 'ã¨ã¦ã‚‚æ‚ªã„',
                    2: 'æ‚ªã„',
                    3: 'æ™®é€š',
                    4: 'è‰¯ã„',
                    5: 'ã¨ã¦ã‚‚è‰¯ã„'
                };
                
                const emoji = moodEmojis[mood.mood] || 'â“';
                const description = moodDescriptions[mood.mood] || 'ä¸æ˜';
                
                // ã‚«ãƒ¼ãƒ‰ã®èƒŒæ™¯è‰²ã‚’ãƒ ãƒ¼ãƒ‰ã«å¿œã˜ã¦è¨­å®š
                const moodColors = {
                    1: '#ffe6e6',
                    2: '#fff3e6',
                    3: '#fffbe6',
                    4: '#e6f7e6',
                    5: '#e6ffe6'
                };
                card.style.backgroundColor = moodColors[mood.mood] || '#f0f0f0';
                
                card.innerHTML = `
                    <div class="mood-date">${dateStr} (${dayOfWeek})</div>
                    <div class="mood-value">${emoji}</div>
                    <div><strong>${mood.mood}/5</strong></div>
                    <div class="mood-description">${description}</div>
                    ${mood.note ? `<div class="mood-note">"${mood.note}"</div>` : ''}
                `;
                
                container.appendChild(card);
            });
        }
        
        /**
         * Gemini APIåˆ†æã‚’å®Ÿè¡Œ
         */
        async function runAnalysis() {
            // UIã®è¦ç´ ã‚’å–å¾—
            const button = document.getElementById('analyzeBtn');
            const resultDiv = document.getElementById('analysisResult');
            
            // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—
            const parameters = {
                focus: document.getElementById('focus').value,
                detail_level: document.getElementById('detail_level').value,
                response_style: document.getElementById('response_style').value
            };
            
            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ã—ã¦ã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
            button.disabled = true;
            button.textContent = 'â³ åˆ†æä¸­...';
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"><div class="spinner"></div>Gemini APIã§åˆ†æã—ã¦ã„ã¾ã™...</div>';
            
            try {
                // APIã«åˆ†æãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(parameters)
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    // åˆ†æçµæœã‚’è¡¨ç¤º
                    resultDiv.innerHTML = `
                        <h3>âœ¨ åˆ†æçµæœ</h3>
                        <div class="analysis-content">
                            ${formatAnalysisText(result.data.analysis_text)}
                        </div>
                        <div class="analysis-meta">
                            <strong>ğŸ“‹ åˆ†ææƒ…å ±</strong><br><br>
                            <div style="display: grid; grid-template-columns: auto 1fr; gap: 8px 15px; align-items: center;">
                                <span>ğŸ¯ ç„¦ç‚¹:</span> <span>${getParameterLabel('focus', result.data.parameters.analysis_focus)}</span>
                                <span>ğŸ“Š è©³ç´°åº¦:</span> <span>${getParameterLabel('detail_level', result.data.parameters.detail_level)}</span>
                                <span>ğŸ’¬ ã‚¹ã‚¿ã‚¤ãƒ«:</span> <span>${getParameterLabel('response_style', result.data.parameters.response_style)}</span>
                                <span>ğŸ“ˆ åˆ†æå¯¾è±¡:</span> <span>${result.data.activity_count}ä»¶ã®æ´»å‹•ã€${result.data.mood_count}æ—¥åˆ†ã®ãƒ ãƒ¼ãƒ‰</span>
                            </div>
                        </div>
                    `;
                } else {
                    // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                    resultDiv.innerHTML = `<div class="error">âŒ ${result.message}</div>`;
                }
            } catch (error) {
                // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãªã©ã‚’è¡¨ç¤º
                console.error('åˆ†æã‚¨ãƒ©ãƒ¼:', error);
                resultDiv.innerHTML = `<div class="error">âŒ åˆ†æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}</div>`;
            } finally {
                // ãƒœã‚¿ãƒ³ã‚’å†åº¦æœ‰åŠ¹åŒ–
                button.disabled = false;
                button.textContent = 'ğŸš€ åˆ†æã‚’å®Ÿè¡Œ';
            }
        }
        
        /**
         * åˆ†æãƒ†ã‚­ã‚¹ãƒˆã‚’æ•´å½¢ã—ã¦è¡¨ç¤º
         * @param {string} text - åˆ†æçµæœã®ãƒ†ã‚­ã‚¹ãƒˆ
         */
        function formatAnalysisText(text) {
            return text
                .trim()
                .replace(/\*\*(.*?)\*\*/g, '<strong style="color: #333; font-weight: 600;">$1</strong>')  // **å¤ªå­—** ã‚’HTMLã«å¤‰æ›
                .replace(/â– /g, '<strong style="color: #667eea; font-size: 1.05em;">â– </strong>')  // ç®‡æ¡æ›¸ãè¨˜å·ã‚’å¼·èª¿
                .replace(/\n{3,}/g, '\n\n')  // 3ã¤ä»¥ä¸Šã®é€£ç¶šæ”¹è¡Œã‚’2ã¤ã«
                .replace(/\n\n/g, '</div><div style="margin: 18px 0; line-height: 1.8;">')  // æ®µè½åŒºåˆ‡ã‚Š
                .replace(/\n/g, '<br>')  // å˜ä¸€æ”¹è¡Œã‚’brã«
                .replace(/^/, '<div style="margin: 0; line-height: 1.8;">')  // æœ€åˆã«divã‚¿ã‚°
                .replace(/$/, '</div>')  // æœ€å¾Œã«divã‚¿ã‚°é–‰ã˜
        }
        
        /**
         * ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å€¤ã‹ã‚‰è¡¨ç¤ºç”¨ãƒ©ãƒ™ãƒ«ã‚’å–å¾—
         * @param {string} type - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ç¨®é¡
         * @param {string} value - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤
         */
        function getParameterLabel(type, value) {
            const labels = {
                focus: {
                    mood: 'æ°—åˆ†',
                    activities: 'æ´»å‹•',
                    balance: 'ãƒãƒ©ãƒ³ã‚¹',
                    wellness: 'ã‚¦ã‚§ãƒ«ãƒã‚¹'
                },
                detail_level: {
                    brief: 'ç°¡æ½”',
                    standard: 'æ¨™æº–',
                    detailed: 'è©³ç´°'
                },
                response_style: {
                    friendly: 'è¦ªã—ã¿ã‚„ã™ã„',
                    professional: 'å°‚é–€çš„',
                    encouraging: 'åŠ±ã¾ã—',
                    casual: 'ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«'
                }
            };
            
            return labels[type][value] || value;
        }
    </script>
</body>
</html>